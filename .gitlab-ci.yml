include:
- file: /r4.1/gitlab-base.yml
  project: QubesOS/qubes-continuous-integration
- file: /r4.1/gitlab-dom0.yml
  project: QubesOS/qubes-continuous-integration
- file: /r4.1/gitlab-vm.yml
  project: QubesOS/qubes-continuous-integration
- file: /r4.2/gitlab-base.yml
  project: QubesOS/qubes-continuous-integration
- file: /r4.2/gitlab-host.yml
  project: QubesOS/qubes-continuous-integration
- file: /r4.2/gitlab-vm.yml
  project: QubesOS/qubes-continuous-integration
checks:pylint:
  before_script:
  - sudo dnf install -y python3-rpm
  - pip3 install --quiet -r ci/requirements.txt
  script:
  - export PATH="$HOME/.local/bin:$PATH"
  - PYTHONPATH=test-packages pylint --extension-pkg-whitelist=rpm,lxml qubesadmin
  stage: checks
  tags:
  - docker
checks:blacklint:
  before_script:
  - sudo dnf install -y python3-black
  - pip3 install --quiet -r ci/requirements.txt
  script:
  - black -l 80 -v --diff --color --check qubesadmin
  stage: checks
  tags:
  - docker
checks:tests:
  after_script:
  - ci/codecov-wrapper
  before_script:
  - sudo dnf install -y openssl python3-rpm sequoia-sqv
  - pip3 install --quiet -r ci/requirements.txt
  - git config --global --add safe.directory "$PWD"
  script:
  - python3 setup.py build
  # simulate "normal" qubes env for most tests
  - export DISPLAY=:0
  - ./run-tests
  - python3 -m coverage xml
  stage: checks
  tags:
  - docker
  variables:
    ENABLE_SLOW_TESTS: 1
    USER: gitlab-runner
